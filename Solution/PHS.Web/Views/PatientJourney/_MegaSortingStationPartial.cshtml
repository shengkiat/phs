@model ICollection<PHS.DB.Modality>
@using PHS.DB
@using PHS.Business.ViewModel.PatientJourney
@using PHS.FormBuilder.Helpers
@using PHS.FormBuilder.Extensions
@using GridMvc.Html


@{
    ViewBag.Title = "Mega Sorting Station - Form A";
}


<script>
    $(document).ready(function () {
    $(".cbk").change(function () {
        var select = "";
        $("input[type = 'checkbox']").each(function () {
            var c = $(this).is(":checked");
            if (c) {
                select = select + "1|";

            } else { 
                select = select + "0|";
            }
        })
        
                $.ajax(
                    {
                        type: "GET",
                        url: '@Url.Action("ActivateCirclesFromMSSS", "PatientJourney")', // Controller/View
                        data: {'activateList': select},
                        contentType: "application/json; charset=utf-8",
                        success: function (resp) {
                            $('#ptJourney').html(resp);
                        }
                    });

        });
    });
    
    $(document).ready(function () {
        $(".labelNo").each(function () {
            $(this).keyup(function () {
                calculateSum();
            });
        });

        $(".labelNo").each(function () {
            $(this).click(function () {
                calculateSum();
            });
        });

        $(".labelNo").each(function () {
            $(this).ready(function () {
                calculateSum();
            });
        });

    });

    function calculateSum() {

        var sum = 0;
        //iterate through each textboxes and add the values
        $(".labelNo").each(function () {

            //add only if the value is number
            if (!isNaN(this.value) && this.value.length != 0) {
                sum += parseFloat(this.value);
            }

        });
        $("#sum").html(sum.toFixed(0));
    }

    function printLabels() {
        alert("Printing " + document.getElementById("sum").innerText + " Labels");
    }

</script>



@using (Html.BeginForm())
{
    <h2>Mega Sorting Station - Form A</h2>

    <div>
        <table id="tableFormA" class="table">
            <tr>
                <td>
                    
                </td>
                <td>
                    <b>Eligibility</b>
                </td>
                <td>
                    <b>Interest</b>
                </td>
                <td>
                    <b>No. of Labels</b>
                </td>
            </tr>
            @for (int i = 0; i < Model.Count; i++)
            {
                <tr>
                    <td  style="text-align:center">
                        <b align="center">@Model.ElementAt(i).Name</b>
                        <br />
                        <img src="@Model.ElementAt(i).IconPath" height="40" width="40" />
                    </td>
                    <td>Eligibility</td>
                    <td>@Html.CheckBoxFor(m => m.ElementAt(i).IsActive, new { @class = "cbk", modIsActive = Model.ElementAt(i).Name })</td>
                    <td>@Html.TextBoxFor(m => m.ElementAt(i).Position, new { @class = "labelNo", @type = "number" })</td>
                </tr>

            }
        </table>

    </div>

    <br />
    <div id="summation">
        <b>&nbsp;</b>
        <b align="right">Number of Labels to be Printed:</b>
        <b align="center"><span id="sum">0</span></b>
    </div>
    <input type="button" value="Print Labels" onclick="printLabels()"/>
}

