@using PHS.DB
@model IEnumerable<form>

@{
    ViewBag.Title = "Index";
}

@section headerScripts{
    <script type="text/javascript" src="@Url.Content("~/scripts/jquery.filedrop.js")"></script>

}

<style type="text/css">
    #dropZone {
        background: gray;
        border: black dashed 3px;
        width: 200px;
        padding: 50px;
        text-align: center;
        color: white;
    }
</style>


<h2>Import Data</h2>


@Html.DropDownList("ddl", Model.Select(item => new SelectListItem
{
    Value = item.ID.ToString(),
    Text = item.Title.ToString()

}), "Select Form")

<button type="button" id="btnTemplate">Download Form Template</button>

<div>
    <input type="file" id="FileUpload1" />
    <input type="button" id="btnUpload" value="Upload Files" />
</div>

<div id="dropZone">Drop your files here</div>
<br />
Uploaded Files:
<ul id="uploadResult"></ul>

<script type="text/javascript">

    $(document).ready(function () {
        templateClickFunction();
        draganddrop();
    });

    function templateClickFunction() {
        $("#btnTemplate").click(function () {

            var id = document.getElementById('ddl').value
            alert(id);

            var jsonObject = {
                "formid": id
            };

            $.ajax({
                url: "@Url.Action("GenerateFormTemplate")",
                type: "POST",
                data: JSON.stringify(jsonObject),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                error: function (response) {


                },
                success: function (response) {
                    window.location = '/formimport/DownloadFormTemplate?fileGuid=' + response.FileGuid
                  + '&filename=' + response.FileName;
                }
            });

        });
    }

    function draganddrop() {
        $('#dropZone').filedrop({
            url: '@Url.Action("UploadFiles")',
            paramname: 'files',
            maxFiles: 1,
            dataType: "json",
            data: {
                formid: function () {
                    return $("#ddl option:selected").val(); 
                },
            },
            error: function (err, file) {
                switch (err) {
                    case 'BrowserNotSupported':
                        alert('browser does not support HTML5 drag and drop')
                        break;
                    case 'TooManyFiles':
                        // user uploaded more than 'maxfiles'
                        break;
                    case 'FileTooLarge':
                        // program encountered a file whose size is greater than 'maxfilesize'
                        // FileTooLarge also has access to the file which was too large
                        // use file.name to reference the filename of the culprit file
                        break;
                    case 'FileTypeNotAllowed':
                        // The file type is not in the specified list 'allowedfiletypes'
                        break;
                    case 'FileExtensionNotAllowed':
                        // The file extension is not in the specified list 'allowedfileextensions'
                        break;
                    default:
                        break;
                }
            },
            error: function (response) {
                $('#uploadResult').append('<li>' + response + '</li>');

            },
            success: function (response) {
                $('#uploadResult').append('<li>' + response + '</li>');
            },
            dragOver: function () {
                $('#dropZone').css('background', 'blue');
            },
            dragLeave: function () {
                $('#dropZone').css('background', 'gray');
            },
            drop: function () {
                $('#dropZone').css('background', 'gray');
            },
            afterAll: function () {
                $('#dropZone').html('The file(s) have been uploaded successfully!');
            },
            uploadFinished: function (i, file, response, time) {
                // $('#uploadResult').append('<li>' + file.name + '</li>');
            }
        });
    }
</script>