@model PHS.Business.ViewModel.FormExport.FormExportViewModel

@using PHS.Common
@using PHS.Business.Extensions
@using PHS.DB.ViewModels.Form

@{
    ViewBag.Title = "Form Export";
    
}
@section headerScripts{
    <script type="text/javascript" src="@Url.Content("~/scripts/form-builder/fbuilder.utils.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/scripts/form-builder/fbuilder.global.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/scripts/form-builder/fbuilder.layout.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/scripts/css_browser_selector.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/scripts/form-builder/fbuilder.entries.js")"></script>

    <link type="text/css" href="@Url.Content("~/Content/css/form-builder/Forms-common.css")" rel="stylesheet" />
    <link type="text/css" href="@Url.Content("~/Content/css/form-builder/Forms-interface.css")" rel="stylesheet" />  
}

<script>

    function formIdFunction(selectedobject) {
        $('#sortTable > div').remove();

    }


    //similar code in fbuilder.entries.js
    function myFunction(selectedobject) {
        var label = selectedobject.value;

        var selectField = "criteria[" + label + "]";

        $(selectedobject).parent().parent().parent().find("#tdCriteriaFields").each(function () {
            $(this).find('input, select').each(function () {
                if ($(this).attr("id") == selectField) {
                    $(this).show();
                } else {
                    $(this).hide();
                }

            });
        });

    }


</script>

<div class="form-page-container prepend-top span-26">        
    
        <div class="inner-container clear-both">
            @Html.WriteMessages()<br />
            @using (Html.BeginForm("Export", "FormExport", FormMethod.Post))
            {
                <input id="eventId" type="hidden" value="@Model.EventID" />

                <ul class="horizontal-list form-actions-list">
                    <li>
                        @Html.DropDownList("FormID", new SelectList(Model.Forms, "FormID", "Title", string.Empty), new { @onchange = "formIdFunction(this)" })
                        <input type="submit" name="submitButton" class="green" value="Export to Excel" />
                    </li>

                </ul>
                    <div class="sort-container">
                        <ul class="horizontal-list form-actions-list">
                            <li>
                                <label style="font-size: 16px;">Sort</label>
                                <a id="sortButton" name="sortButton" class="hyperlink-button light-blue-button">+</a>
                            </li>
                        </ul>

                        <table class="sort-table" cellpadding="0" cellspacing="0" id="sortTable">

                            @foreach (var sortField in Model.SortFields)
                            {
                                Html.RenderPartial("_ViewEntriesSortPartial", sortField);
                            }
                        </table>
                    </div>

                    <div class="criteria-container">
                        <ul class="horizontal-list form-actions-list">
                            <li>
                                <label style="font-size: 16px;">Criteria</label>
                                <a id="criteriaButton" name="criteriaButton" class="hyperlink-button light-blue-button">+</a>
                            </li>
                        </ul>

                        <table class="criteria-table" cellpadding="0" cellspacing="0" id="criteriaTable">
                            <tbody id="trCriteriaRow0" style="display:none;">

                                @foreach (var crtieriaField in Model.CriteriaFields)
                                {
                                    Html.RenderPartial("_ViewEntriesCriteriaPartial", crtieriaField);
                                }

                            </tbody>
                        </table>
                    </div>

               // @Html.HiddenFor(m => m.TemplateID);
            }            
        </div>   
        
</div>
@section footerScripts{
    
    <script type="text/javascript">
        $(document).ready(function () {
            entries.init();

        });
    </script>
}
